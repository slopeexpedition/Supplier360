<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Create Wallet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
  <link rel="stylesheet" href="assets/css/main.css" />

</head>

<body>
  <style>
    label,
    legend {
      margin: 0 !important;
      font-weight: bold;
    }

    .form-group {
      margin-bottom: 15px !important;
    }

    input.btn {
      float: right !important;
    }

    .expandable>legend:before {
      content: '\25B8';
      padding-right: 5px;
    }
  

    .expanded>legend:before {
      content: '\25BE';
    }

    .modal-content {
      /* Bootstrap sets the size of the modal in the modal-dialog class, we need to inherit it */

      /* To center horizontally */
      margin: 0 auto;
      pointer-events: all;
    }
  </style>
  <div id="page-wrapper">
    <header id="header" class="alt" style="background-color: black;">
      <h1 style="margin-top: 10px;"><a href="Supplier_Landing.html"><img src="images/Logo.png" style="width:50%"></img>
      </h1>
      <nav id="nav">
        <ul>
          <li><a href="Supplier360_CentralWallet.html">Create Central Wallet</a></li>
          <li>
            <a href="#" class="icon solid fa-angle-down">Supplier</a>
            <ul>
              <li><a href="Supplier360_ManageSuppliers.html">Manage Suppliers</a></li>
              <li><a href="Supplier360_SupplierMetrics.html">Supplier Metrics</a></li>
            </ul>
          </li>
          <li>
            <a href="#" class="icon solid fa-angle-down">Transactions</a>
            <ul>
              <li><a href="Supplier360_MakePayment.html">Transfer Funds</a></li>
              <li><a href="Supplier360_DisbursePayout.html">Disburse Funds</a></li>
            </ul>
          </li>

          <li><a href="Contact.html">Contact</a></li>
          <!-- <li><a href="#" class="button">Sign In</a></li> -->
        </ul>
      </nav>
    </header>
  </div>
  <form style="width: 50%;margin-left: 29px;margin-top: 2%;color: black;"></form>
  <div class="container">



    <div id="Grid" class="mt-3" style="margin-left: -180px;margin-right: -179px"></div>
  </div>
  <br></br>

  <pre id="myText"></pre>
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class=""></div>
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="width:1500px;height:600px;">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel"></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" style="width:1500px;height:600px;">
          <iframe src="Supplier360_SupplierDashboards.html" width="1200" height="500"></iframe>>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  </div>
  <br></br>
  <footer id="footer">
    <ul class="icons">
      <li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
      <li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
      <li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
      <li><a href="#" class="icon brands fa-github"><span class="label">Github</span></a></li>
      <li><a href="#" class="icon brands fa-dribbble"><span class="label">Dribbble</span></a></li>
      <li><a href="#" class="icon brands fa-google-plus"><span class="label">Google+</span></a></li>
    </ul>
    <ul class="copyright">
      <li>&copy; Rapyd's Climate Fintech Hackathon. All rights reserved.</li>
    </ul>
  </footer>
  <div id="res" class="alert"></div>
  <script src="https://storage.googleapis.com/chart-api-db/assets/js/jquery.min.js"></script>
  <script src="https://storage.googleapis.com/chart-api-db/assets/js/jquery.dropotron.min.js"></script>
  <script src="https://storage.googleapis.com/chart-api-db/assets/js/jquery.scrollex.min.js"></script>
  <script src="https://storage.googleapis.com/chart-api-db/assets/js/browser.min.js"></script>
  <script src="https://storage.googleapis.com/chart-api-db/assets/js/breakpoints.min.js"></script>
  <script src="https://storage.googleapis.com/chart-api-db/assets/js/util.js"></script>
  <script src="https://storage.googleapis.com/chart-api-db/assets/js/main.js"></script>
  <script type="text/javascript" src="https://storage.googleapis.com/chart-api-db/CDN/deps/underscore.js"></script>
  <script type="text/javascript" src="https://storage.googleapis.com/chart-api-db/CDN/deps/opt/jsv.js"></script>
  <script type="text/javascript" src="https://storage.googleapis.com/chart-api-db/CDN/lib/jsonform.js"></script>
  <script src="https://cdn.syncfusion.com/ej2/dist/ej2.min.js" type="text/javascript"></script>
  <link href="https://cdn.syncfusion.com/ej2/material.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.3.2/uuidv4.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
    crossorigin="anonymous"></script>

  <script id="template" type="text/x-template">
    <div>
        <a href="#" onclick="showMyModalSetTitle()">${SupplierName}</a>
    </div>
</script>

  <script type="text/javascript">
    $('#myText').hide();
    function showMyModalSetTitle(myTitle) {

      //$('#exampleModalLabel').html(myTitle);

      $('#exampleModal').modal('show');
    }
    function httpGet(theUrl) {

      let xmlhttp;

      if (window.XMLHttpRequest) { // code for IE7+, Firefox, Chrome, Opera, Safari
        xmlhttp = new XMLHttpRequest();
      } else { // code for IE6, IE5
        xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
      }

      xmlhttp.onreadystatechange = function () {
        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
          return xmlhttp.responseText;
        }
      }
      xmlhttp.open("GET", theUrl, false);
      xmlhttp.send();

      return xmlhttp.response;
    }

    $('form').jsonForm({
      "schema": {
        wallet_type: {
          type: 'string',
          "title": "Select Account Type:",
          default: "person",
          enum: [
            'person',
            'company'
          ]
        },
        phone_number: {
          "type": "string",
          "title": "Phone Number",
          default: "+14155551311"
        },
        email: {
          "type": "string",
          "title": "Email ID",
          default: "michael.king@rapyd.com"
        },
        first_name: {
          "type": "string",
          "title": "First name",
          default: "Michael"
        },
        last_name: {
          "type": "string",
          "title": "Last name",
          default: "King"
        },
        mothers_name: {
          "type": "string",
          "title": "Mothers name",

          default: "Jane Smith"
        },
        contact_type: {
          "type": "string",
          "title": "Contact Type",
          enum: ['personal', 'business'],
          default: "personal"
        },
        address_lines: {
          "type": "string",
          "title": "Address",
          default: "123 Main Street"
        },
        name: {
          "type": "string",
          "title": "First name",
          default: "Michael King"
        },
        city: {
          "type": "string",
          "title": "City",
          default: "New York"
        },
        state: {
          "type": "string",
          "title": "State",
          default: "NY"
        },
        country: {
          "type": "string",
          "title": "Country",
          default: "US"
        },
        postal_code: {
          "type": "string",
          "title": "ZIP Code",
          default: "123456"
        },
        add_phone_number: {
          "type": "string",
          "title": "Phone Number",
          default: "+14123456789"
        },
        type_of_id: {
          "type": "string",
          "title": "Type Of Id",
          default: "PA",
          enum: ["Driver Licence", "Government ID", "PA"]
        },
        id_value: {
          "type": "string",
          "title": "ID Number",
          default: "1234567890"
        },
        date_of_birth: {
          "type": "string",
          "title": "Date Of Birth",
          default: "11/22/2000"
        },
        id_country: {
          "type": "string",
          "title": "Identification Country",
          default: "US"
        },
        id_nationality: {
          "type": "string",
          "title": "Identification Nationality",
          enum: ["Resident", "Non-Resident", "FR"],
          default: "FR"
        },
        business_entity_type: {
          "type": "string",
          "title": "Entity Type",
          default: "US"
        },
        SupplierID: {
          type: 'number',
          default: 100001,
          readonly: true
        },
        supplier_name: {
          "type": "string",
          "title": "Business Name",
          default: "Escrow Wallet"
        },
        business_registration_number: {
          "type": "string",
          "title": "Registration Number",
          default: "4234567779"
        },
        business_industry_category: {
          "type": "string",
          "title": "Industry Category",
          default: "company"
        },
        business_industry_sub_category: {
          "type": "string",
          "title": "Industry Sub Category",
          default: "home services"
        },
        business_address_lines: {
          "type": "string",
          "title": "Address",
          default: "123 Main Street"
        },
        business_name: {
          "type": "string",
          "title": "Supplier name",
          default: "Henry Company"
        },
        business_city: {
          "type": "string",
          "title": "Supplier City",
          default: "888 Some Street"
        },
        business_state: {
          "type": "string",
          "title": "Supplier State",
          default: "NY"
        },
        business_country: {
          "type": "string",
          "title": "Supplier Country",
          default: "US"
        },
        business_nationality: {
          "type": "string",
          "title": "Supplier Nationality",
          enum: ["US", "IT", "NY"],
          default: "IT"
        },
        business_postal_code: {
          "type": "string",
          "title": "Supplier ZIP Code",
          default: "123456"
        },
        business_add_phone_number: {
          "type": "string",
          "title": "Supplier Phone Number",
          default: "+14123456789"
        }

      },
      // value: {
      //   SupplierID: localStorage.getItem("supplier_id"),
      //   supplier_name: localStorage.getItem("supplier_name")

      // },
      "form": [
        {
          "type": "selectfieldset",
          "title": "Select Wallet Type",
          "key": "wallet_type",
          "titleMap": {
            "person": "Personal Wallet (Individual)",
            "company": "Company Wallet (Business)"
          },
          "items": [
            {
              "type": "fieldset",
              "title": "Select wallet Details",
              "expandable": true,
              "items": [
                {
                  "key": "phone_number"
                },
                {
                  "key": "email"
                },
                {
                  "key": "first_name"
                },
                {
                  "key": "last_name"
                },
              ]
            },
            {
              "type": "fieldset",
              "expandable": false,
              "items": [

                {
                  "key": "SupplierID",
                  title: "Supplier ID"
                },
                {
                  "key": "supplier_name",
                  title: "Supplier Name"
                },
                {
                  "type": "fieldset",
                  "title": "Select wallet Details",
                  "expandable": true,
                  "items": [
                    {
                      "key": "phone_number"
                    },
                    {
                      "key": "email"
                    },
                    {
                      "key": "business_entity_type"
                    },
                    {
                      "key": "business_registration_number"
                    },
                    {
                      "key": "business_industry_category"
                    },
                    {
                      "key": "business_industry_sub_category"
                    },
                    {
                      "key": "business_address_lines"
                    },
                    {
                      "key": "business_name"
                    },
                    {
                      "key": "business_city"
                    },
                    {
                      "key": "business_state"
                    },
                    {
                      "key": "business_country"
                    },
                    {
                      "key": "business_nationality"
                    },
                    {
                      "key": "business_postal_code"
                    },
                    {
                      "key": "business_add_phone_number"
                    },


                  ]
                }

              ]
            }

          ]
        },

        {
          "type": "fieldset",
          "title": "Fill Holder's Contact Details",
          "expandable": true,
          "items": [
            {
              "key": "name"
            },
            {
              "key": "mothers_name"
            },
            {
              "key": "contact_type",
              "titleMap": {
                "personal": "Personal Contact (Individual)",
                "business": "Company Contact (Business)"
              }
            },
            {
              "key": "address_lines"
            },

            {
              "key": "city"
            },
            {
              "key": "state"
            },
            {
              "key": "country"
            },
            {
              "key": "postal_code"
            },
            {
              "key": "add_phone_number"
            }
          ]
        },
        {
          "type": "fieldset",
          "title": "Fill Identification Details",
          "expandable": true,
          "items": [
            {
              "key": "type_of_id"
            },
            {
              "key": "id_value"
            },
            {
              "key": "date_of_birth"
            },
            {
              "key": "id_country"
            },
            {
              "key": "id_nationality"
            }
          ]
        },
        {
          "type": "actions",
          "items": [
            {
              "type": "submit",
              "title": "Submit"
            }
          ]
        }
      ],
      onSubmit: function (errors, values) {
        if (errors) {
          console.log(errors)
          debugger
          $('#res').html('<p>Please fill required fields!</p>');
        }
        else {
          $("#spinner").show();
          var paramsObj = {};
          paramsObj.type = "RapydAPI";
          paramsObj.queryType = "create_wallet";
          var record = {};
          record.type = values.wallet_type;
          record.phone_number = values.phone_number;
          record.email = values.email;
          record.first_name = values.first_name;
          record.last_name = values.last_name;
          record.mothers_name = values.mothers_name;
          record.contact_type = values.contact_type;
          record.address_lines = values.address_lines;
          record.name = values.name;
          record.city = values.city;
          record.state = values.state;
          record.country = values.country;
          record.postal_code = values.postal_code;
          record.add_phone_number = values.add_phone_number;
          record.type_of_id = values.type_of_id;
          record.id_value = values.id_value;
          record.date_of_birth = values.date_of_birth;
          record.id_country = values.id_country;
          record.id_nationality = values.id_nationality;
          record.supplier_name = values.supplier_name;



          paramsObj.record = record;
          console.log(JSON.stringify(paramsObj));
          // alert(JSON.stringify(paramsObj));
          debugger
          var data = JSON.parse(httpGet("https://chart-api-6httuqd2wq-uc.a.run.app?dbParams=" + JSON.stringify(paramsObj)));
          debugger
          document.getElementById("myText").innerHTML = "";
          document.getElementById("myText").innerHTML += "Your Wallet Creation Attempt Details:" + "\n";
          alert(JSON.stringify(data));

          for (var key in data) {
            //if (data.hasOwnProperty(key)) {
            debugger
            if (typeof (data[key]) == "object") {
              document.getElementById("myText").innerHTML += "\n";
              document.getElementById("myText").innerHTML += "Wallet Creation " + key.toUpperCase() + " Details:" + "\n";
              for (var key1 in data[key]) {
                if (data[key][key1] != "" && data[key][key1] != null && typeof (data[key][key1]) != "object") {
                  document.getElementById("myText").innerHTML += "    " + key1.toUpperCase() + " : " + data[key][key1] + "\n";
                }
              }
              document.getElementById("myText").innerHTML += "\n";
            }
            else if (data[key] != "" && data[key] != null) {
              document.getElementById("myText").innerHTML += key.toUpperCase() + " : " + data[key] + "\n";
            }
            // console.log(key + " : " + data.account_data[key]);


            // document.getElementById("myText").innerHTML += JSON.stringify(data) + "\n";



            //}
          }
          $('#myText').show();
          var ewallet_id = data["ewallet"];
          var paramsObj = {};
          paramsObj.type = "MongodbData";
          paramsObj.database = "Industry";
          paramsObj.collection = "Suppliers";
          paramsObj.queryType = "update";
          var old_record = {};
          old_record.SupplierID = values.SupplierID;
          paramsObj.oldRecord = old_record;
          var record = {};
          record.EwalletID = ewallet_id;
          paramsObj.record = record;
          let url = "https://chart-api-6httuqd2wq-uc.a.run.app?dbParams=" + JSON.stringify(paramsObj);
          fetch(url)



          $("#spinner").hide();
        }
      }
    });

  </script>
 
</body>

</html>